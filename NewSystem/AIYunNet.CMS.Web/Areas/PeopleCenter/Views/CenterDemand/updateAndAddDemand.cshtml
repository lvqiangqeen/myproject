@model AIYunNet.CMS.Domain.Model.DecDemand
@using AIYunNet.CMS.Common.Utility;
@using AIYunNet.CMS.BLL.Service
@using AIYunNet.CMS.BLL.IService
@using AIYunNet.CMS.Domain.Model
@{
    ViewBag.Title = "updateAndAddDemand";
    Layout = "~/Areas/PeopleCenter/Views/Shared/_LayoutCenter.cshtml";
    DemandService deSer = new DemandService();
    WebCommonService commonService = new WebCommonService();
    t_AreaService areaService = new t_AreaService();
    //工作年限
    List<WebLookup> typelist = commonService.GetLookupList("Demand_type");
    IEnumerable<SelectListItem> demandtypelist = typelist.Select(com => new SelectListItem { Value = com.Code.ToString(), Text = com.Description });
    //省份
    IEnumerable<SelectListItem> provinceList = null;
    List<t_Province> common = areaService.GetProvinceList();
    provinceList = common.Select(com => new SelectListItem { Value = com.provinceID.ToString(), Text = com.province });
}

<style>
    #stageCaseForm textarea, input {
        border: 1px solid #ccc;
        border-radius: 4px;
        width: 100%;
    }

    #stageCaseForm .set_div > input {
        width: 10%;
        height: 40px;
    }

    #stageCaseForm .set_l {
        margin-right: 10px;
        margin-left: 10px;
    }

    #stageCaseForm .div_workstage span {
        padding: 10px;
    }

    #stageCaseForm .div_workstage input {
        width: 20px;
        height: 20px;
        display: inline;
        margin-right: 5px;
    }
    .form-control {
    display: inline; 
}
</style>
<div class="centers_mr">
    <div class="centers_r_items">
        <div class="upload-left">
            <form id="stageCaseForm">
                @Html.HiddenFor(m => m.id)
                <div class="req-push-title"><p class="req-name"><i></i><span>填写需求信息</span></p></div>
                <div class="form-box-list">
                    <div class="tab-l"><span class="form-box-label"><i>*</i>小区名称</span></div>
                    <div class="tab-r">
                        @Html.TextBoxFor(m => m.buidingname, new { @class = "form-ipt-txt", placeholder = "请简单写出您的标题（5-20个字)" })
                    </div>
                    <div class="clearfiexd"></div>
                </div>
                <div class="form-box-list">
                    <div class="tab-l"><span class="form-box-label"><i>*</i>需求类型</span></div>
                    <div class="tab-r">
                        @Html.DropDownListFor(m => m.DemandType, new SelectList(demandtypelist, "Value", "Text"), new { @class = "form-control", id = "DemandType", style = "width:20%" })
                    </div>
                    <div class="clearfiexd"></div>
                </div>
                <div class="form-box-list">
                    <div class="tab-l"><span class="form-box-label"><i></i>所在城市</span></div>
                    <div class="tab-r">
                        @Html.DropDownListFor(m => m.ProvinceID, new SelectList(provinceList, "Value", "Text"), new { @class = "form-control", id = "ProvinceID", style = "width:20%;" })
                        <select name="CityID" class="form-control" id="cityid" style = "width:20%;"></select>
                    </div>
                    <div class="clearfiexd"></div>
                </div>
                <script>
                    $(function () {
                        var provinceid = $("#ProvinceID").val();
                        var ProvinceName = "";
                        getcitylist(provinceid);
                        $("#ProvinceID").change(function () {
                            provinceid = $("#ProvinceID").val();
                            ProvinceName = $("#ProvinceID").find("option:selected").text();
                            getcitylist(provinceid);
                        });
                        function getcitylist(provinceid) {
                            $.ajax({
                                async: false,
                                type: "post",
                                url: "/SysAdmin/city/GetCityListByfather",
                                data: {
                                    father: provinceid
                                },
                                success: function (data) {
                                    if (data != null) {
                                        var html = '';
                                        $.each(data.list, function (i, item) {
                                            html += '<option value="' + item.cityID + '">' + item.city + '</option>'
                                        });
                                        $("#cityid").empty();
                                        $("#cityid").append(html);

                                    }
                                    else {

                                    }
                                },
                                error: function (xhr, type) {
                                    alert('Ajax error!2');
                                }
                            });
                        }
                    })
                </script>
                <div class="form-box-list">
                    <div class="tab-l">
                        <span class="form-box-label">装修面积</span>
                    </div>
                    <div class="tab-r">
                        @Html.TextBoxFor(m => m.buidingSpace, new { style = "width:10%" }) m²
                    </div>
                    <div class="clearfiexd"></div>
                </div>
                <div class="form-box-list">
                    <div class="tab-l"><span class="form-box-label">您的姓名</span></div>
                    <div class="tab-r">
                        @Html.TextBoxFor(m => m.ownername, new { @class = "form-ipt-txt", style = "width:20%" })
                    </div>
                    <div class="clearfiexd"></div>
                </div>
                <div class="form-box-list">
                    <div class="tab-l"><span class="form-box-label">您的联系方式：</span></div>
                    <div class="tab-r">
                        @Html.TextBoxFor(m => m.ownertel, new { @class = "form-ipt-txt", style = "width:20%" })
                    </div>
                    <div class="clearfiexd"></div>
                </div>
                <div class="form-box-list">
                    <div class="tab-l"><span class="form-box-label">简单介绍</span></div>
                    <div class="tab-r">
                        @Html.TextBoxFor(m => m.OneSentence, new { @class = "form-ipt-txt", placeholder = "一句话描述您的需求" })
                    </div>
                    <div class="clearfiexd"></div>
                </div>
                <div class="form-box-list">
                    <div class="tab-l">
                        <span class="form-box-label">需求说明</span>
                    </div>
                    <div class="tab-r">
                        @Html.TextAreaFor(m => m.Info, new { row = "4", col = "10" })
                    </div>
                    <div class="clearfiexd"></div>
                </div>

                <div class="form-box-list">
                    <div class="tab-l">
                        <span class="form-box-label">设置</span>
                    </div>
                    <div class="tab-r set_div">
                        <span class="set_l">是否同时发布到需求大厅</span>
                        @Html.CheckBoxFor(m => m.IsPublish, new { style = "width:20px;height:20px;" })
                    </div>
                    <div class="clearfiexd"></div>
                </div>
                <div class="form-box-list">
                    <a id="btnSubmit" class="btn-submit" href="javascript:void()">提交发布</a>
                </div>
            </form>
        </div>
    </div>
</div>
@section Scripts{


    <script>

        $(function () {

            $("#btnSubmit").click(function () {
                var id = $("input[name=id]").val();
                var buidingname = $("#buidingname").val();
                var BuidingTitle = $("#BuidingTitle").val();
                if (!BuidingTitle) {
                    alert("标题不能为空");
                    $("#BuidingTitle").focus();
                    return;
                }
                var BuidingID = $("#BuidingID").val();
                var BuidingBrief = $("#BuidingBrief").val();
                var BuidingInfo = $("#BuidingInfo").val();
                var Price = $("#Price").val();
                var Space = $("#Space").val();
                var selectedStagesCode = $("#selectedStagesCode").val();
                var selectedStagesText = $("#selectedStagesText").val();
                var ShowOrder = $("#ShowOrder").val();
                var IsHot = $("#IsHot").prop("checked") ? true : false;
                var IsTop = $("#IsTop").prop("checked") ? true : false;
                var BuidingImage = $("#ImageUrl").val();
                var thumbnailImage = $("#thumbnailImage").val();
                var StartTime = $("#datetimepicker").val();
                $.ajax({
                    type: "post",
                    url: "/PeopleCenter/CenterCases/AddOrEditBuidingStages",
                    data: {
                        BuidingID: BuidingID,
                        BuidingTitle: BuidingTitle,
                        BuidingBrief: BuidingBrief,
                        BuidingInfo: BuidingInfo,
                        Price: Price,
                        Space: Space,
                        ConstructionstageID: selectedStagesCode,
                        Constructionstage: selectedStagesText,
                        ShowOrder: ShowOrder,
                        IsHot: IsHot,
                        IsTop: IsTop,
                        BuidingImage: BuidingImage,
                        thumbnailImage: thumbnailImage,
                        StartTime: StartTime,
                    },
                    success: function (data) {
                        if (data.RetCode == 1) {
                            if (BuidingID > 0) {
                                alert("修改成功！");
                            } else {
                                alert("添加成功！");
                            }
                            window.location.href =  $.session.get('lasturl');

                        }
                    }

                });
            });

        })

    </script>
}
