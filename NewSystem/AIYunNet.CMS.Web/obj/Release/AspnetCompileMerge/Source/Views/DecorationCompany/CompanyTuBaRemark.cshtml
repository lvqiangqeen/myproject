@model AIYunNet.CMS.Domain.Model.WebCompany
@using AIYunNet.CMS.BLL.Service;
@using AIYunNet.CMS.Domain.Model;
@using AIYunNet.CMS.BLL.IService;
@using AIYunNet.CMS.Common.Utility
@{
    ViewBag.Title = "CompanyTuBaRemark";
    Layout = "~/Views/Shared/_LayoutDecCompany.cshtml";
    string companyuserAcount = SessionHelper.Get("companyUserName");
    string PeopleuserAcount = SessionHelper.Get("userName");
    string UserAccount = "";
    if (companyuserAcount != null)
    {
        UserAccount = companyuserAcount;
    }
    if (PeopleuserAcount != null)
    {
        UserAccount = PeopleuserAcount;
    }
}

@{ Html.RenderPartial("_CompanyTuBaHead");}
@{Html.RenderPartial("_GetAllSessions"); }
<link href="~/Content/Plugins/wangEditor/css/wangEditor.css" rel="stylesheet" />
<link href="~/Content/Css/common/pagination.css" rel="stylesheet" />
<script type="text/javascript" src="/content/comment/demo.js"></script>
<style>
        .blog_left {
            float: left;
            width: 130px;
        }

        .cont_l .left_list ul li {
            margin-top: 15px;
            width: 100px;
            cursor: pointer;
        }

        .blog_right {
            float: right;
            width: 850px;
        }
        .content selected {
            width: 100px;
        }
        .clear {
            height: 12px;
        }
        .content {
        width: auto;
    }
        input.sub_btn_q {
                width: 100px;
        margin-right: 10px;
            border-radius: 3px;
        -webkit-box-shadow: none;
        box-shadow: none;
        border: 1px solid transparent;
            display: inline-block;
        padding: 6px 12px;
        margin-bottom: 0;
        font-size: 14px;
        font-weight: 400;
        line-height: 1.42857143;
        text-align: center;
        white-space: nowrap;
        vertical-align: middle;
        }
        input.sub_btn {
            color: #fff;
        width: 100px;
        margin-right: 10px;
        background-color: #3c8dbc;
        border-color: #367fa9;
            border-radius: 3px;
        -webkit-box-shadow: none;
        box-shadow: none;
        border: 1px solid transparent;
            display: inline-block;
        padding: 6px 12px;
        margin-bottom: 0;
        font-size: 14px;
        font-weight: 400;
        line-height: 1.42857143;
        text-align: center;
        white-space: nowrap;
        vertical-align: middle;
    }

        /*body {
            font-size: 12px;
            line-height: 120%;
            text-align: center;
            color: #333;
        }*/

        /*a {
            color: #333;
            text-decoration: none;
        }*/

            /*a:hover {
                text-decoration: underline;
            }*/

        /** {
            margin: 0;
            padding: 0;
            border: none;
        }*/

        .clearfix:after {
            content: ".";
            display: block;
            height: 0;
            clear: both;
            visibility: hidden;
        }

        .clearfix {
            *height: 1%;
        }

        #list {
            margin: 0 auto;
            text-align: left;
            width: 830px;
        }

        .box {
            border-top: 1px solid #eee;
            position: relative;
            width: 820px;
            padding: 20px 0;
        }

            .box:hover .close {
                display: block;
            }

        .close {
            display: none;
            top: 0px;
            right: 0px;
            width: 28px;
            height: 28px;
            border: 1px solid #eee;
            position: absolute;
            background: #f2f4f7;
            line-height: 27px;
            text-align: center;
        }

            .close:hover {
                background: #c8d2e2;
                text-decoration: none;
            }

        .head {
            float: left;
            width: 60px;
            height: 60px;
            margin-right: 10px;
        }

        .contentcomment {
            float: left;
            width: 725px;
        }

        .main {
            margin-bottom: 10px;
        }

        .txt {
            margin-bottom: 10px;
        }

        .user {
            color: #369;
        }

        .pic {
            margin-right: 5px;
            width: 200px;
            border: 1px solid #eee;
        }

        .info {
            height: 20px;
            line-height: 19px;
            font-size: 12px;
            margin: 0 0 10px 0;
        }

            .info .time {
                color: #ccc;
                float: left;
                height: 20px;
                padding-left: 20px;
                background: url("/content/comment/images/bg1.jpg") no-repeat left top;
            }

            .info .praise {
                color: #369;
                float: right;
                height: 20px;
                padding-left: 18px;
                background: url("/content/comment/images/bg2.jpg") no-repeat left top;
            }

                .info .praise:hover {
                    text-decoration: underline;
                    background: url("/content/comment/images/bg3.jpg") no-repeat left top;
                }

        .praises-total {
            margin: 0 0 10px 0;
            height: 20px;
            background: url("/content/comment/images/praise.png") no-repeat 5px 5px rgb(247, 247, 247);
            padding: 5px 0 5px 25px;
            line-height: 19px;
        }

        .comment-box {
            padding: 10px 0;
            border-top: 1px solid #eee;
        }

            .comment-box:hover {
                background: rgb(247, 247, 247);
            }

            .comment-box .myhead {
                float: left;
                width: 30px;
                height: 30px;
                margin-right: 10px;
            }

            .comment-box .comment-content {
                float: left;
                width: 650px;
            }

                .comment-box .comment-content .comment-time {
                    color: #ccc;
                    margin-top: 3px;
                    line-height: 16px;
                    position: relative;
                }

                .comment-box .comment-content .comment-praise {
                    display: none;
                    color: #369;
                    padding-left: 17px;
                    height: 20px;
                    background: url("/content/comment/images/praise.png") no-repeat;
                    position: absolute;
                    bottom: 0px;
                    right: 44px;
                }

                .comment-box .comment-content .comment-operate {
                    display: none;
                    color: #369;
                    height: 20px;
                    position: absolute;
                    bottom: 0px;
                    right: 10px;
                }

                .comment-box .comment-content:hover .comment-praise {
                    display: inline-block;
                }

                .comment-box .comment-content:hover .comment-operate {
                    display: inline-block;
                }

        .text-box .comment {
            border: 1px solid #eee;
            display: block;
            height: 15px;
            width: 700px;
            padding: 5px;
            resize: none;
            color: #ccc;
        }

        .text-box .btn {
            font-size: 12px;
            font-weight: bold;
            display: none;
            float: right;
            width: 65px;
            height: 25px;
            border: 1px solid #0C528D;
            color: #fff;
            background: #4679AC;
        }

        .text-box .btn-off {
            border: 1px solid #ccc;
            color: #ccc;
            background: #F7F7F7;
        }

        .text-box .word {
            display: none;
            float: right;
            margin: 7px 10px 0 0;
            color: #666;
        }

        .text-box-on .comment {
            height: 50px;
            color: #333;
        }

        .text-box-on .btn {
            display: inline;
        }

        .text-box-on .word {
            display: inline;
        }



</style>

<div class="main_content clear">
    <div class="blog_right">
        <div class="br_select clear" id="tiwen">
            <dl>
                <dt>我要提问</dt>
            </dl>
        </div>
        <div class="blog_dp_container">
            <form id="commentform" method="post" action="">
                <textarea class="form_field" id="comment-message" title="Comment*" rows="5" cols="45" name="comment" style="width: 838px;height:200px;"></textarea>
                <p class="form-submit">
                    <input type="reset" value="清空 " id="reset" name="reset" class="sub_btn_q">
                    <input type="button" value="提交" id="submit" name="submit" class="sub_btn">
                    <input type="hidden" id="comment_post_ID" value="754" name="comment_post_ID">
                    <input type="hidden" value="0" id="comment_parent" name="comment_parent">
                </p>
            </form>
        </div>
        <div class="clear"></div>
        <div class="br_select clear" id="jiaoliu">
            <dl>
                <dt>交流社区</dt>
            </dl>
        </div>
        <div class="blog_dp_container">
            <!--相关评论-->
            <div id="list">
                <div class="box clearfix" v-for="item in pageList">
                    <a class="close" href="javascript:;">×</a>
                    <img class="head" alt="" v-bind:src="'@AppSettingsHelper.ImgUrl'+item.comment.thum" style="border-radius:50%; overflow:hidden;" />
                    <div class="contentcomment">
                        <div class="main">
                            <p class="txt">
                                <span class="user">{{item.comment.from_uname}}：</span>
                            <p v-html="item.comment.content"></p>
                            </p>
                        </div>
                        <div class="info clearfix">
                            <span class="time">{{item.comment.addtime}}</span>
                            <a class="praise" href="javascript:;">赞</a>
                            <input type="hidden" v-bind:value="item.comment.comment_guid" />
                        </div>

                        <div v-if="item.comment.ZanCount=='0'" class="praises-total" total="0" style="display: none;"></div>

                        <div v-else class="praises-total" v-bind:total="item.comment.ZanCount" style="display: block;">{{item.comment.ZanCount}}个人觉得很赞</div>


                        <div class="comment-list" v-for="ite in item.reCommentList">
                            <div v-if="ite.from_account=='@UserAccount'" class="comment-box clearfix" user="self">
                                <img class="myhead" v-bind:src="'@AppSettingsHelper.ImgUrl'+ite.thum" alt="" style="border-radius:50%; overflow:hidden;" />
                                <div class="comment-content">
                                    <p class="comment-text"><span class="user">{{ite.from_uname}} ：</span>{{ite.content}}</p>
                                    <p class="comment-time">
                                        {{ite.addtime}}
                                        <a href="javascript:;" class="comment-operate" style="display:none;">删除</a>
                                    </p>
                                </div>
                            </div>

                            <div v-else class="comment-box clearfix" user="other">
                                <img class="myhead" v-bind:src="'@AppSettingsHelper.ImgUrl'+ite.thum" alt="" style="border-radius:50%; overflow:hidden;" />
                                <div class="comment-content">
                                    <p class="comment-text"><span class="user">{{ite.from_uname}} ：</span>{{ite.content}}</p>
                                    <p class="comment-time">
                                        {{ite.addtime}}
                                        <a href="javascript:;" class="comment-operate" style="display:none;">回复</a>
                                        <input type="hidden" class="to_account" v-bind:value="ite.from_account" />
                                        <input type="hidden" class="to_uid_type" v-bind:value="ite.from_uid_type" />
                                        <input type="hidden" class="to_uname" v-bind:value="ite.from_uname" />

                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="text-box" style="display:none;">
                            <textarea class="comment" autocomplete="off">评论…</textarea>
                            <button class="btn ">回 复</button>
                            <input type="hidden" class="comment_guid" v-bind:value="item.comment.comment_guid" />
                            <span class="word"><span class="length">0</span>/140</span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 页码开始 -->
            <div class="team_page">
                <div class="M-box1" style="text-align:center;"></div>
            </div>
        </div>

    </div>
    <div class="blog_left">
        <div class="cont_l">
            <div class="left_list">
                <ul>
                    <li class="on"><a href="#tiwen">我要提问</a></li>
                    <li><a href="#jiaoliu">交流社区</a></li>
                </ul>
            </div>
        </div>
    </div>

</div>
<input id="topic_id" value="@Model.CompanyID" type="hidden" />
<input id="topic_type" value="WebCompany" type="hidden" />
<input id="urlthum" value="@AppSettingsHelper.ImgUrl" type="hidden" />

@section Scripts{
    <script src="~/Content/Plugins/wangEditor/js/wangEditor.js"></script>
    <script>
        $(function () {
            //getHeight();
            //function getHeight() {
            //    var getHeight = $('.blog_right').height();

            //    $('.main_content').css('height', getHeight + 'px');

            //}

            var editor = new wangEditor('comment-message');

            // 上传图片
            editor.config.uploadImgUrl = '/SysAdmin/FileUpload/UploadFileForEditor';

            // 配置自定义参数
            editor.config.uploadParams = {
                token: 'abcdefg',
                user: 'wangfupeng1988'
            };
            // 设置 headers
            editor.config.uploadHeaders = {
                'Accept': 'text/x-json'
            };
            //普通的自定义菜单
            editor.config.menus = [
        'emotion', 'img'
            ];

            editor.create();
            $('#reset').click(function () {
                // 清空内容。
                // 不能传入空字符串，而必须传入如下参数
                editor.clear();
            });



        })
        var noticeVue = new Vue({
            el: '#list',
            data: {
                pageList: []
            },
            mounted: function () {
                this.getHeight();
                this.GetPageList(1);
            },
            methods: {
                //分页查询
                GetPageList: function (pageIndex) {
                    var _self = this;
                    var PageSize = 10;
                    var topic_id = $("#topic_id").val();
                    var topic_type = $("#topic_type").val();
                    $.ajax({
                        async: false,
                        type: "post",
                        url: "../Handler/GetPageListAjax.ashx",
                        data: {
                            pageIndex: pageIndex,
                            PageSize: PageSize,
                            topic_id: topic_id,
                            topic_type: topic_type,
                            methodname: "GetCommentList"
                        },
                        success: function (data) {
                            if (data) {
                                var datajson = eval('(' + data + ')');
                                _self.pageList = datajson.list;

                                //列出页码,jq分页控件
                                $('.M-box1').pagination({
                                    totalData: datajson.recordcount,
                                    showData: PageSize,
                                    coping: true,
                                    current: pageIndex,
                                    callback: _self.pageselectCallback
                                });

                                Vue.nextTick(function () {
                                   // $("html,body").animate({ scrollTop: 0 }, 500);
                                    _self.getHeight();

                                });

                            } else {
                                _self.pageList = [];
                            }
                        },
                        error: function (xhr, type) {
                            alert('Ajax error!');
                        }
                    });

                },
                //分页回调函数
                pageselectCallback: function (pageIndex) {
                    var _self = this;
                    //获取当前页码
                    _self.GetPageList(pageIndex.getCurrent());
                },
                //js获取Url参数
                GetQueryString: function (name) {
                    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                    var r = window.location.search.substr(1).match(reg);
                    if (r != null) return unescape(r[2]); return null;
                },
                getHeight: function () {
                    var getHeight = $('.blog_right').height();
                    $('.main_content').css('height', getHeight + 'px');

                }

            }
        });
    </script>

}
